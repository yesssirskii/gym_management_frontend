<p-toast></p-toast>
<p-dialog 
    [header]="'PROFILE.TITLE' | translate" 
    [(visible)]="visible" 
    [modal]="true" 
    [style]="{width: '600px', height: '920px'}"
    [closable]="true"
    [draggable]="false"
    (onHide)="onDialogHide()">
    
    <p-tabView>
        <p-tabPanel [header]="'PROFILE.INFO_TAB' | translate">
            <div class="profile-section" *ngIf="user">
                <div class="profile-header">
                    <div class="avatar">
                        <i class="pi pi-user"></i>
                    </div>
                    <div class="profile-info">
                        <h3>{{ user.firstName }} {{ user.lastName }}</h3>
                        <p>{{ user.email }}</p>
                        <p-tag [value]="user.userType" severity="info"></p-tag>
                    </div>
                </div>
                
                <p-divider></p-divider>
                
                <form [formGroup]="profileForm">
                    <div class="field-group">
                        <div class="field-row">
                            <div class="field">
                                <label for="firstName">{{ 'PROFILE.First_Name' | translate }}</label>
                                <input type="text" id="firstName" pInputText formControlName="firstName" class="w-full" />
                            </div>
                        
                            <div class="field">
                                <label for="lastName">{{ 'PROFILE.Last_Name' | translate }}</label>
                                <input type="text" id="lastName" pInputText formControlName="lastName" class="w-full" />
                            </div>
                        </div>

                        <div class="field">
                            <label for="username">{{ 'USERS.Basic_Info.Username' | translate }}:</label>
                            <input type="text" id="username" pInputText formControlName="username" class="w-full" />
                        </div>
                        
                        <div class="field">
                            <label for="email">{{ 'PROFILE.Email' | translate }}</label>
                            <input type="email" id="email" pInputText formControlName="email" class="w-full" />
                        </div>
                        
                        <div class="field">
                            <label for="phoneNumber">{{ 'PROFILE.Phone' | translate }}</label>
                            <input type="tel" id="phoneNumber" pInputText formControlName="phoneNumber" class="w-full" />
                        </div>
                        
                        <div class="field">
                            <label for="address">{{ 'PROFILE.Address' | translate }}</label>
                            <textarea id="address" pInputTextarea formControlName="address" rows="2" class="w-full"></textarea>
                        </div>
                        
                        <div class="action-buttons">
                            <p-button 
                                [label]="'PROFILE.UPDATE_INFO' | translate" 
                                icon="pi pi-save"
                                [loading]="loadingProfile"
                                [disabled]="profileForm.invalid || !profileForm.dirty"
                                (onClick)="updateProfile()">
                            </p-button>
                        </div>
                    </div>
                </form>
            </div>
        </p-tabPanel>
        
        <p-tabPanel [header]="'PROFILE.PASSWORD_TAB' | translate">
            <form [formGroup]="passwordForm">
                <div class="field">
                    <label for="currentPassword">{{ 'PROFILE.CURRENT_PASSWORD' | translate }}</label>
                    <p-password 
                        id="currentPassword" 
                        formControlName="currentPassword" 
                        styleClass="w-full"
                        [feedback]="false">
                    </p-password>
                </div>
                
                <div class="field">
                    <label for="newPassword">{{ 'PROFILE.NEW_PASSWORD' | translate }}</label>
                    <p-password 
                        id="newPassword" 
                        formControlName="newPassword" 
                        styleClass="w-full"
                        [toggleMask]="true">
                    </p-password>
                </div>
                
                <div class="field">
                    <label for="confirmPassword">{{ 'PROFILE.CONFIRM_PASSWORD' | translate }}</label>
                    <p-password 
                        id="confirmPassword" 
                        formControlName="confirmPassword" 
                        styleClass="w-full"
                        [feedback]="false">
                    </p-password>
                </div>
                
                <div class="password-requirements">
                    <p>{{ 'PROFILE.PASSWORD_REQUIREMENTS' | translate }}:</p>
                    <ul>
                    <li>{{ 'PROFILE.MIN_LENGTH' | translate }}</li>
                    <li>{{ 'PROFILE.UPPERCASE' | translate }}</li>
                    <li>{{ 'PROFILE.LOWERCASE' | translate }}</li>
                    <li>{{ 'PROFILE.NUMBER' | translate }}</li>
                    </ul>
                </div>
                
                <div class="action-buttons">
                    <p-button 
                        [label]="'PROFILE.CHANGE_PASSWORD' | translate" 
                        icon="pi pi-key"
                        severity="warning"
                        [loading]="loadingPassword"
                        [disabled]="passwordForm.invalid"
                        (onClick)="changePassword()">
                    </p-button>
                </div>
            </form>
        </p-tabPanel>
        
        <p-tabPanel [header]="'PROFILE.ACTIVITY_TAB' | translate">
            <div class="activity-section">
            <p-table [value]="activityLog" [paginator]="true" [rows]="10">
                <ng-template pTemplate="header">
                <tr>
                    <th>{{ 'PROFILE.DATE' | translate }}</th>
                    <th>{{ 'PROFILE.ACTION' | translate }}</th>
                    <th>{{ 'PROFILE.DETAILS' | translate }}</th>
                </tr>
                </ng-template>
                <ng-template pTemplate="body" let-activity>
                <tr>
                    <td>{{ activity.date | date:'short' }}</td>
                    <td>{{ activity.action }}</td>
                    <td>{{ activity.details }}</td>
                </tr>
                </ng-template>
            </p-table>
            </div>
        </p-tabPanel>
    </p-tabView>
</p-dialog>